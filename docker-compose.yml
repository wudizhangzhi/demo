version: "2" 
services:
    web:
        build: ./web/
        command: bash -c "python manage.py makemigrations &&
                          python manage.py migrate &&
                          python manage.py collectstatic &&
                          uwsgi --ini uwsgi.conf"
        ports:
            - "8000:8000"
        volumes:
            - /home
            - /log
        links:
            - db
            - redis
    
    db:
        image: mysql:5.7.19 
        volumes:
            - ./db:/var/lib/mysql
        environment:
            - MYSQL_ROOT_PASSWORD=password
            - MYSQL_DATABASE=demon

    redis:
        restart: always
        image: redis:lastest
        volumes:
            - /data
