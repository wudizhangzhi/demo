version: "2" 
services:
    mysql:
        image: mysql:5.7.19
        volumes:
            - /var/lib/mysql
        environment:
            - MYSQL_ROOT_PASSWORD=password
            - MYSQL_DATABASE=demon

    web:
        build: ./web/
        command: bash -c "python manage.py makemigrations &&
                          python manage.py migrate &&
                          python manage.py collectstatic -c <<< yes &&
                          supervisor -n -c supervisord.conf"
        ports:
            - "8000:8000"
        volumes:
            - /main
            - /var/log/demon/:/log
            - /tmp
        links:
            - mysql:mysql 
            - redis:redis
    
    redis:
        restart: always
        image: redis:latest
        volumes:
            - /data
